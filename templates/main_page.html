<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ENIAC</title>
  <style>
    :root { --gap: 16px; --max: 720px; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; line-height: 1.5; }
    header { padding: var(--gap); border-bottom: 1px solid #ddd; display: flex; align-items: center; }
    .brand { font-size: 1.8rem; font-weight: 700; letter-spacing: .04em; }
    .header-actions { margin-left: auto; display: flex; align-items: center; gap: 12px; }
    nav { display: flex; gap: 12px; }
    nav a { text-decoration: none; color: inherit; padding: 4px 8px; border-radius: 6px; }
    .btn { appearance: none; border: 1px solid #333; background: #111; color: #fff; padding: 6px 12px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: .95rem; cursor: pointer; }
    .btn:hover { background: #000; }
    .btn.small { padding: 4px 10px; font-size: .85rem; }
    .profile-wrap { position: relative; }
    .profile-pill { background: #111; color: #fff; border-radius: 999px; padding: 6px 10px; font-weight: 700; letter-spacing: .06em; min-width: 36px; text-align: center; border: 0; cursor: pointer; }
    .profile-menu { position: absolute; right: 0; top: calc(100% + 6px); background: #fff; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,.15); min-width: 160px; overflow: hidden; opacity: 0; transform: translateY(-6px) scale(.98); transform-origin: top right; pointer-events: none; transition: opacity .16s ease, transform .16s ease; }
    .profile-wrap.open .profile-menu { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
    .profile-item { display: block; width: 100%; padding: 10px 12px; text-align: left; background: #fff; border: 0; cursor: pointer; font-weight: 600; }
    .profile-item:hover { background: #f5f5f5; }
    main { max-width: var(--max); margin: 0 auto; padding: var(--gap); display: flex; flex-direction: column; gap: var(--gap); }
    section { padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
    section h2 { margin: 0 0 8px; font-size: 1.1rem; }
    ul { margin: 0; padding-left: 18px; }
    footer { padding: var(--gap); text-align: center; font-size: .9rem; color: #555; border-top: 1px solid #eee; }

    /* Login modal */
    .modal { position: fixed; inset: 0; display: none; z-index: 1000; }
    .modal.open { display: block; }
    .modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.5); }
    .modal-dialog { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
      width: min(420px, 92vw); background: #fff; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,.25); padding: 20px; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .modal-title { margin: 0; font-size: 1.25rem; }
    .modal-close { border: none; background: transparent; font-size: 1.4rem; line-height: 1; cursor: pointer; padding: 4px 8px; }
    .field { display: grid; gap: 6px; margin: 10px 0; }
    .field input { padding: 10px 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
    .modal-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 12px; }
    .btn.secondary { background: #fff; color: #111; border-color: #999; }
    .btn.secondary:hover { background: #f4f4f4; }
  </style>
</head>
<body>
  <header>
    <div class="brand">ENIAC</div>
    <div class="header-actions">
      <nav aria-label="Main">
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('klubbar') }}">Clubs</a>
        <a href="{{ url_for('dagskra') }}">Schedule</a>
      </nav>
      {% if session.get('user') %}
        <div class="profile-wrap">
          <button id="profileBtn" class="profile-pill" aria-haspopup="menu" aria-expanded="false" title="{{ session['user'] }}">{{ session['user'][:3]|upper }}</button>
          <div id="profileMenu" class="profile-menu" role="menu" aria-label="Profile menu">
            <form method="post" action="{{ url_for('logout') }}">
              <button class="profile-item" type="submit" role="menuitem">Log out</button>
            </form>
          </div>
        </div>
      {% else %}
        <a id="loginBtn" class="btn" href="#login" aria-label="Log in">Log in</a>
      {% endif %}
    </div>
  </header>

  <!-- Login Modal -->
  <div id="loginModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-dialog" role="dialog" aria-labelledby="loginTitle" aria-modal="true">
      <div class="modal-header">
        <h2 id="loginTitle" class="modal-title">Log in</h2>
        <button class="modal-close" type="button" aria-label="Close" data-close="true">×</button>
      </div>
      <form method="post" action="{{ url_for('login') }}">
        <label class="field">
          <span>Username</span>
          <input name="username" type="text" autocomplete="username" required>
        </label>
        <label class="field">
          <span>Password</span>
          <input name="password" type="password" autocomplete="current-password" required>
        </label>
        <div class="modal-actions">
          <a class="btn small secondary" href="{{ url_for('register') }}">Create account</a>
          <button class="btn secondary" type="button" data-close="true">Cancel</button>
          <button class="btn" type="submit">Log in</button>
        </div>
      </form>
    </div>
  </div>

  <main>
    <section aria-labelledby="welcome">
      <h2 id="welcome">Welcome</h2>
      <p>This is the ENIAC front page. Sign in and other features will be added later.</p>
    </section>

    <section aria-labelledby="announcements">
      <h2 id="announcements">Announcements</h2>
      <ul>
        <li>Placeholder announcement one.</li>
        <li>Placeholder announcement two.</li>
        <li>Placeholder announcement three.</li>
      </ul>
    </section>

    <section aria-labelledby="events">
      <h2 id="events">Upcoming</h2>
      <ul>
        <li>Event A — 12:00</li>
        <li>Event B — 15:00</li>
        <li>Event C — 18:00</li>
      </ul>
    </section>
  </main>

  <footer>© 2025 ENIAC</footer>

  <script>
    (function(){
      const openBtn = document.getElementById('loginBtn');
      const modal = document.getElementById('loginModal');
      const profileBtn = document.getElementById('profileBtn');
      const profileWrap = profileBtn ? profileBtn.closest('.profile-wrap') : null;
      let lastFocused = null;

      function openModal(e){
        if (e) e.preventDefault();
        lastFocused = document.activeElement;
        modal.classList.add('open');
        modal.setAttribute('aria-hidden', 'false');
        const user = modal.querySelector('input[name="username"]');
        if (user) user.focus();
      }
      function closeModal(){
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden', 'true');
        if (lastFocused && typeof lastFocused.focus === 'function') lastFocused.focus();
      }
      if (openBtn) openBtn.addEventListener('click', openModal);
      modal.addEventListener('click', (e)=>{
        if (e.target.dataset.close === 'true') closeModal();
      });
      document.addEventListener('keydown', (e)=>{
        if (e.key === 'Escape') {
          if (modal.classList.contains('open')) closeModal();
          if (profileWrap && profileWrap.classList.contains('open')) toggleProfile(false);
        }
      });

      function toggleProfile(forceState){
        if (!profileWrap) return;
        const isOpen = typeof forceState === 'boolean' ? forceState : !profileWrap.classList.contains('open');
        profileWrap.classList.toggle('open', isOpen);
        profileBtn.setAttribute('aria-expanded', String(isOpen));
      }
      if (profileBtn) {
        profileBtn.addEventListener('click', (e)=>{
          e.preventDefault();
          toggleProfile();
        });
        document.addEventListener('click', (e)=>{
          if (!profileWrap.contains(e.target)) toggleProfile(false);
        });
      }
    })();
  </script>
</body>
</html>

